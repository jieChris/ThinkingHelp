# ThinkingHelp 主体功能开发路线图（下一阶段）

## 1. 文档目的
本文件用于汇总当前拟新增的 8 个主体功能，并给出可执行的开发顺序、依赖关系和阶段验收标准，作为后续迭代实施基线。

## 2. 功能清单（汇总）
1. 个性化目标中心（热量/三大营养素目标、阶段进度）
2. 控糖专项模式（糖尿病用户：血糖记录、事件、分析）
3. 饮食-食谱闭环优化（基于用户反馈持续调优食谱）
4. 预包装食品识别（条码/配料/营养成分自动录入）
5. OCR 结构化确认流（体检报告识别后的人工确认）
6. 风险预警与随访提醒（异常趋势预警与任务提醒）
7. 知识库可追溯推荐（AI 建议附来源依据）
8. 多角色协作（家属/医生只读共享）

## 3. 排序原则
- 先做高价值闭环：优先完成“记录 -> 分析 -> 建议 -> 复盘”的核心链路。
- 先做强依赖基础：后续能力依赖的数据质量与反馈机制要提前完成。
- 先稳准确性再扩展角色：先确保用户端建议可解释、可追踪，再做协作外延。

## 4. 推荐开发顺序（最终排序）
1. 控糖专项模式（2）
2. 饮食-食谱闭环优化（3）
3. OCR 结构化确认流（5）
4. 风险预警与随访提醒（6）
5. 预包装食品识别（4）
6. 知识库可追溯推荐（7）
7. 个性化目标中心（1）
8. 多角色协作（8）

> 说明：`个性化目标中心`虽然重要，但依赖前面几项产生稳定、可信的数据与解释内容，放到后段实现更稳。

## 5. 分阶段实施计划

### Phase A：核心医疗营养闭环（优先）
包含：2 -> 3 -> 5

#### A1. 控糖专项模式（2）
**目标**：让糖尿病用户形成可追踪、可分析的日常管理闭环。  
**开发范围**：
- 数据层：新增血糖记录（空腹/餐后2小时/睡前）、低血糖事件、用药备注。
- 后端：血糖记录 CRUD、按日/周聚合、波动分析接口。
- 前端：控糖视图、趋势图、高低值标注。
- 规则：低血糖/高血糖阈值与告警等级。
**依赖**：现有健康档案、饮食记录已可用。  
**验收标准**：
- 用户可按时间记录并查看血糖趋势。
- 系统可识别异常区间并给出风险提示。
- 可关联到当日饮食记录进行简单归因。

#### A2. 饮食-食谱闭环优化（3）
**目标**：用户“吃不饱/过量”反馈能稳定影响后续生成。  
**开发范围**：
- 数据层：完善反馈权重、衰减策略、餐次偏好模型。
- 后端：反馈聚合逻辑、生成前参数注入、调整记录留痕。
- 前端：显示“本次食谱已根据你最近反馈做了哪些调整”。
**依赖**：A1 的更细粒度健康数据可增强调整逻辑。  
**验收标准**：
- 连续反馈后，后续食谱在份量/配餐结构上可见变化。
- 页面可展示变化依据（如早餐主食 +15%）。

#### A3. OCR 结构化确认流（5）
**目标**：提升档案数据质量，避免 OCR 误识别污染模型输入。  
**开发范围**：
- OCR 结果按字段输出置信度。
- 新增“确认页”：低置信度项必须确认后入库。
- 变更审计：记录“原始识别值-人工确认值”。
**依赖**：无强依赖，建议在闭环基础后尽快补齐。  
**验收标准**：
- OCR 导入必须经过确认页后落库。
- 可追踪每个关键指标是否人工修订。

### Phase B：可执行管理能力
包含：6 -> 4

#### B1. 风险预警与随访提醒（6）
**目标**：从“看数据”升级为“可执行计划”。  
**开发范围**：
- 规则引擎：血压/血糖/体重异常趋势规则。
- 提醒任务：日常记录提醒、复测提醒、复诊提醒。
- 通知中心：站内提醒 + 待办列表。
**依赖**：A1/A3 提供稳定数据来源。  
**验收标准**：
- 异常趋势可触发提醒。
- 用户可完成/忽略提醒，状态可追踪。

#### B2. 预包装食品识别（4）
**目标**：减少手动录入，提高饮食数据完整度。  
**开发范围**：
- 条码识别、营养标签 OCR。
- 营养成分结构化映射（每 100g/每份）。
- 一键回填饮食记录。
**依赖**：基础饮食记录模型已完善。  
**验收标准**：
- 用户扫描后可自动填写食物与主要营养素。
- 可选择“按份/按克”自动换算。

### Phase C：可信推荐与产品扩展
包含：7 -> 1 -> 8

#### C1. 知识库可追溯推荐（7）
**目标**：提升 AI 建议可信度与合规性。  
**开发范围**：
- RAG 返回段落携带来源文档、章节、发布时间。
- 前端显示“建议依据”。
- 对过期/冲突资料做优先级规则。
**依赖**：知识库建设已有基础。  
**验收标准**：
- 每条关键建议可查看来源。
- 可区分“通用建议”和“个体化推断”。

#### C2. 个性化目标中心（1）
**目标**：把多模块结果统一成“可看懂的长期目标管理”。  
**开发范围**：
- 总目标：能量、三大营养素、体重/血糖阶段目标。
- 周报/月报：完成率、偏差、趋势。
- 调整建议：下周目标自动微调。
**依赖**：A/B/C1 完成后数据足够稳定。  
**验收标准**：
- 用户可查看目标达成度与历史变化。
- 目标调整有明确依据。

#### C3. 多角色协作（8）
**目标**：支持家属/医生只读协作，提高长期坚持率。  
**开发范围**：
- 共享授权：按人授权、可撤销、可过期。
- 只读视图：关键指标、食谱执行、风险提醒摘要。
- 审计日志：谁在何时查看了哪些数据。
**依赖**：前面模块稳定后再开放外部协作。  
**验收标准**：
- 用户可安全授权并撤销。
- 协作方仅能看被授权的数据。

## 6. 里程碑与交付建议
- M1（Phase A 完成）：形成“记录-反馈-纠偏”的闭环核心能力。
- M2（Phase B 完成）：从分析走向提醒执行，日常可持续使用。
- M3（Phase C 完成）：建议可信、目标清晰、支持协作。

## 7. 风险与控制
- 风险：AI 建议不稳定、OCR 误识别、数据异常导致误提醒。
- 控制：
  - 关键字段二次确认（OCR）
  - 建议可追溯（RAG 来源展示）
  - 风险提示分级并明确“仅供健康管理参考，非医疗诊断”

## 8. 建议的下一步
建议立即进入 Phase A 的 A1（控糖专项模式）详细设计：
- 输出字段字典
- 接口清单
- 数据库变更脚本
- 页面原型

## 9. 文档同步规则（执行中）
- 每完成一项大改，必须同步更新以下文档：
  - `read/功能任务清单.md`
  - `read/项目变更日志.md`
  - 对应测试用例/测试结果文档
  - 若影响上线策略，同步 `read/商用上线正式使用手册.md`
- 具体维护标准见：`read/文档维护规范.md`
