# ThinkingHelp 项目变更日志

## 使用说明
- 每次“大改”必须新增一条记录，按时间倒序维护（最新在最上）。
- 编号格式：`TH-YYYY-MM-XXX`，例如 `TH-2026-02-001`。
- 若无 SQL/配置变更，请明确写“无”。
- 建议补充“对应提交”字段，便于代码与文档双向追溯。

---

## TH-2026-02-037
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：修复/数据一致性
- 影响范围：健康档案页（数据记录、控糖管理）/首页仪表盘/后端综合记录接口
- 详细说明：
  - 解决“数据记录中的血糖”和“控糖管理中的血糖”双入口冲突问题，统一血糖记录入口为“控糖管理”。
  - 前端“数据记录”模块移除血糖录入与血糖历史列，改为“去控糖管理记录”入口按钮。
  - 首页“一周健康趋势”中的血糖曲线改为读取 `glucose-records` 数据源（优先空腹血糖），避免与 `health_records.glucose` 混用。
  - 后端 `HealthRecordController` 新增保护：综合记录接口自动忽略 `glucose` 字段，防止旧前端继续写入冲突数据。
- SQL/配置变更：无
- 验证结果：代码修复完成；需本地验证数据记录与控糖管理不再互相冲突
- 回滚方案：回退 `HealthProfile.vue`、`Dashboard.vue`、`HealthRecordController.java` 本次改动

## TH-2026-02-036
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：功能/体验优化
- 影响范围：前端食谱中心/后端采购单位格式
- 详细说明：
  - 食谱中心新增“按批次采购（可选）”能力，支持三种模式：全周期一次采购、`4天+剩余天数`、自定义批次。
  - 自定义批次支持选择起止日期并进行区间重叠校验，避免重复采购统计。
  - 批次清单会自动累计同名食材总量（按克合并），并标注“部分数量未标注”场景。
  - 新增批次规划状态重置逻辑：切换到新食谱后，批次配置自动回到默认，避免旧批次残留。
  - 采购文案与单位统一中文：前端展示统一为“克/千克”，后端 `formatWeight` 同步输出“克/千克”。
  - 补充批次区域样式，修复批次结果与标签的布局展示。
- SQL/配置变更：无
- 验证结果：代码实现完成；当前环境无法本地编译验证（WSL1 不支持前端构建，终端未注入 `JAVA_HOME`）
- 回滚方案：回退 `frontend/src/views/plan/MealPlan.vue` 与 `backend/src/main/java/com/thinkinghelp/system/service/impl/ExportServiceImpl.java` 本次改动

## TH-2026-02-035
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：体验/文案本地化
- 影响范围：食谱中心前端/PDF模板/导入解析兼容
- 详细说明：
  - 食谱中心用户可见文案改为中文表达：将“AI营养师”等改为“智能营养师”，将“导出食谱 PDF”改为“导出食谱文档”。
  - 导出文件名由英文改为中文（`食谱.pdf`、`食谱_{id}.pdf`）。
  - 食谱页面营养单位统一中文：`kcal` 显示为“千卡”，`g` 显示为“克”。
  - PDF 模板中的英文标题改为中文（如营养建议、每周食谱安排、日期/早餐/午餐/晚餐）。
  - 后端 PDF 导入解析新增中文标题兼容，同时保留对旧英文标题的兼容。
  - 自动保存默认标题由“AI生成食谱”改为“智能生成食谱”。
- SQL/配置变更：无
- 验证结果：代码修复完成；需本地验证食谱中心页面与导出文档中文显示
- 回滚方案：回退 `MealPlan.vue`、`meal_plan.ftl`、`MealPlanController.java` 本次文案改动

## TH-2026-02-034
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：修复/导出鉴权链路
- 影响范围：后端安全配置/食谱导出
- 详细说明：
  - 修复食谱导出接口被外层安全过滤链误拦截为 403 的问题。
  - `SecurityConfig` 将 `/api/export/pdf` 调整为放行，由控制器内部进行 JWT 校验。
  - `MealPlanController.exportPdf` 新增容错鉴权：无 token/无效 token 返回 401，避免误判为“无权限”。
  - 保留导出资源归属校验（planId 非本人仍返回 404）。
- SQL/配置变更：无
- 验证结果：代码修复完成；需本地重启后端后验证导出
- 回滚方案：回退 `SecurityConfig.java` 与 `MealPlanController.java` 本次改动

## TH-2026-02-033
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：修复/交互策略
- 影响范围：前端/食谱中心导出
- 详细说明：
  - 修正“食谱导出失败即自动注销并跳登录页”的处理策略。
  - 导出接口返回 `401/403/5xx` 时改为仅提示错误，不再清理登录态、不再强制跳转登录页。
  - 保证导出失败只影响当前操作，不影响用户正在进行的其他页面操作。
- SQL/配置变更：无
- 验证结果：代码修复完成；需本地验证导出失败时登录态保持
- 回滚方案：回退 `frontend/src/views/plan/MealPlan.vue` 本次导出异常处理改动

## TH-2026-02-032
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：修复/鉴权稳定性
- 影响范围：后端JWT/前端食谱导出
- 详细说明：
  - 修复 JWT 签名密钥每次启动随机变化导致的 token 失效问题（会表现为接口 403，导出常见）。
  - `JwtUtils` 改为读取配置密钥与过期时间，签名密钥在服务重启后保持稳定。
  - `application.yml` 新增 `jwt.secret` 与 `jwt.expiration` 配置项，支持用环境变量 `JWT_SECRET` 覆盖。
  - 食谱导出接口前端逻辑新增 401/403/5xx 处理：自动清理登录态并跳转登录页，避免停留在失效会话。
- SQL/配置变更：新增配置项（无需执行 SQL）
- 验证结果：代码修复完成；需本地重启后端并重新登录后验证导出
- 回滚方案：回退 `JwtUtils.java`、`application.yml`、`MealPlan.vue` 本次改动

## TH-2026-02-031
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：功能/稳定性修复
- 影响范围：前端/后端/PDF导出/饮食记录
- 详细说明：
  - 修复“饮食记录从食谱导入后营养信息丢失”问题：导入时优先读取食谱中的 `caloriesKcal`、`carbsGrams` 与食材重量，并标记来源为“食谱同步”。
  - 修复“导出已保存食谱偶发生成不可打开文件”问题：
    - 后端导出接口改为显式错误状态返回，避免异常内容被当作 PDF 下载。
    - 前端导出逻辑新增 `content-type` 校验，非 PDF 直接提示错误，不再落地坏文件。
  - 优化导出体验：新增“导出中”加载状态和完成提示，避免无反馈等待。
  - 升级采购清单生成逻辑：按天聚合食材并保留重量（g/kg），长期调料单独聚合；同步用于页面与 PDF 展示。
  - 优化 PDF 采购清单排版：由纯纵向列表改为紧凑卡片/行内标签展示，提升可读性与采购执行性。
  - 新增 `ExportService.enrichMealPlan`：已保存食谱在查看/导出前补齐营养与采购信息（不触发 AI 估算，控制成本）。
- SQL/配置变更：无
- 验证结果：代码实现完成；当前环境无法执行编译验证（WSL1 不支持前端构建、终端未注入 JAVA_HOME）
- 回滚方案：回退 `MealPlanController.java`、`ExportService.java`、`ExportServiceImpl.java`、`meal_plan.ftl`、`MealPlan.vue`、`DietLog.vue`

## TH-2026-02-030
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：功能/流程优化
- 影响范围：后端/前端/食谱中心
- 详细说明：
  - 调整食谱生成流程为“生成成功即自动保存”，用户无需手动点击保存。
  - 后端同步生成接口与异步生成任务在成功后均自动写入 `meal_plans`。
  - 前端移除“保存到食谱中心”按钮，改为“已自动保存到食谱中心”提示。
  - 食谱异步生成成功后自动刷新已保存食谱列表，保证页面立即可见。
- SQL/配置变更：无
- 验证结果：代码实现完成；需本地验证生成后食谱中心自动出现新记录
- 回滚方案：回退 `MealPlanController.java` 与 `MealPlan.vue` 本次自动保存改动

## TH-2026-02-029
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：修复/启动稳定性
- 影响范围：后端/食谱服务
- 详细说明：
  - 修复 `ExportService` 注入链导致应用启动失败的问题。
  - 将 `ExportServiceImpl` 中 `freemarkerConfig` 与 `FoodNutritionCacheMapper` 调整为可选注入，避免因可选能力依赖异常阻塞服务启动。
  - `FoodNutritionCacheMapper` 不可用时，营养计算自动降级为“本地字典 + AI估算”。
  - `freemarkerConfig` 不可用时，仅导出 PDF 功能报错，不影响应用启动。
- SQL/配置变更：无
- 验证结果：代码修复完成；需本地重启后端验证启动与食谱生成功能
- 回滚方案：回退 `backend/src/main/java/com/thinkinghelp/system/service/impl/ExportServiceImpl.java` 本次依赖注入改动

## TH-2026-02-028
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：修复/会话安全
- 影响范围：前端/全局请求拦截
- 详细说明：
  - 调整全局请求拦截器：当检测到服务端内部错误时自动退出当前账号并跳转登录页。
  - 触发条件包含：业务响应 `code=500`，以及 HTTP `500/502/503/504`。
  - 统一 401/403 处理逻辑，复用自动登出流程，避免仅提示不退出导致“假登录状态”。
  - 同步修复 AI 流式对话页（`fetch` 链路），在 401/403/500/502/503/504 时执行同样自动登出。
- SQL/配置变更：无
- 验证结果：代码修复完成；需本地验证 500/502/503/504 与 401/403 场景
- 回滚方案：回退 `frontend/src/api/request.ts` 本次拦截器改动

## TH-2026-02-027
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：功能/体验
- 影响范围：前端/后端/食谱中心
- 详细说明：
  - 新增“历史需求复用”能力：用户过去用于生成食谱的需求会被记录并可快捷复用。
  - 后端新增接口 `GET /api/meal-plan/requirements/history`，按时间倒序返回去重后的最近需求。
  - 前端食谱生成区新增“历史需求”标签区，点击标签可一键填充需求输入框。
  - 在本次输入需求后会先本地前置到历史列表，生成完成后再与后端历史同步。
- SQL/配置变更：无
- 验证结果：代码实现完成；需本地验证历史需求展示、点击回填和生成后同步
- 回滚方案：回退 `MealPlanController.java` 与 `MealPlan.vue` 相关改动

## TH-2026-02-026
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：修复/数据库映射
- 影响范围：后端/食物营养缓存
- 详细说明：
  - 修复 `food_nutrition_cache` 列名映射错误导致的食谱生成失败。
  - `FoodNutritionCache` 实体为 `caloriesPer100g`、`carbsPer100g`、`sugarPer100g` 显式绑定数据库列：
    - `calories_per_100g`
    - `carbs_per_100g`
    - `sugar_per_100g`
  - 避免 MyBatis-Plus 默认驼峰推导成 `*_per100g`（缺少下划线）而报 `Unknown column`。
- SQL/配置变更：无
- 验证结果：代码修复完成；需本地重新生成食谱验证
- 回滚方案：回退 `backend/src/main/java/com/thinkinghelp/system/entity/FoodNutritionCache.java` 本次 `@TableField` 改动

## TH-2026-02-025
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：修复/编译问题
- 影响范围：后端/食谱营养计算
- 详细说明：
  - 修复 `ExportServiceImpl` 中营养字典读取时访问父类私有字段导致的编译错误。
  - `fromCatalog` 由“重建对象并读取私有字段”改为“直接返回匹配项对象”，避免可见性冲突。
- SQL/配置变更：无
- 验证结果：代码级修复完成；请本地重新编译验证
- 回滚方案：回退 `backend/src/main/java/com/thinkinghelp/system/service/impl/ExportServiceImpl.java` 中 `fromCatalog` 方法

## TH-2026-02-024
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：功能/计算逻辑
- 影响范围：后端/前端/PDF导出
- 详细说明：
  - 食谱生成后新增“每餐营养计算”流程：按食材与克重计算每餐热量、碳水、蛋白、脂肪。
  - 食谱返回结构新增每餐营养字段与食材明细字段（`ingredients`、`caloriesKcal`、`carbsGrams`、`proteinGrams`、`fatGrams`）。
  - 计算数据源采用“本地营养字典 + 本地缓存 + AI估算兜底”，并限制单次生成的 AI 估算次数，控制成本。
  - 食谱中心页面新增每餐营养摘要展示（碳水/蛋白/脂肪）。
  - 导出 PDF 新增每餐三大营养素展示。
- SQL/配置变更：无
- 验证结果：代码实现完成；需本地联调验证食谱生成结果和 PDF 内容
- 回滚方案：回退 `ExportServiceImpl`、`MealPlanDTO`、`MealPlan.vue`、`meal_plan.ftl` 相关改动

## TH-2026-02-023
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：功能/体验
- 影响范围：前端/仪表盘
- 详细说明：
  - “今日餐次热量结构”升级为“今日热量结构”，支持两种计量口径共用同一环图。
  - 新增环图点击切换能力：点击环图可在“按餐次热量”和“按食物类型热量”之间切换。
  - 新增食物类型口径分类（碳水类、蛋白质类、脂肪类、蔬果类、其他类），按当日记录热量汇总展示。
  - 卡片头部新增当前模式标签与交互提示“点击环图切换”。
- SQL/配置变更：无
- 验证结果：代码实现完成；需本地页面回归验证两种口径切换与数据展示
- 回滚方案：回退 `frontend/src/views/dashboard/Dashboard.vue` 中环图模式切换与食物分类逻辑

## TH-2026-02-022
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：修复/体验
- 影响范围：前端/仪表盘
- 详细说明：
  - 修复“一周健康趋势”图例（空腹血糖/收缩压）与坐标轴重叠问题。
  - 调整图例位置至图表底部，并增大坐标区底部留白，确保图例显示在坐标下方。
- SQL/配置变更：无
- 验证结果：代码修复完成；需本地页面回归验证图例位置
- 回滚方案：回退 `frontend/src/views/dashboard/Dashboard.vue` 中一周趋势图 `legend/grid` 配置

## TH-2026-02-021
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：修复/体验
- 影响范围：前端/仪表盘
- 详细说明：
  - 修复首页部分卡片出现内部滚动条的问题，改为卡片内容完整展示。
  - 修复首页两行卡片间距过短导致视觉重叠的问题，优化为稳定间距布局。
  - 卡片容器改为弹性布局与统一最小高度，提升不同数据量下的显示一致性。
- SQL/配置变更：无
- 验证结果：代码修复完成；需在本地浏览器回归验证卡片显示与间距
- 回滚方案：回退 `frontend/src/views/dashboard/Dashboard.vue` 本次样式调整

## TH-2026-02-020
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：功能/体验
- 影响范围：前端/后端/数据库/用户设置
- 详细说明：
  - 新增“首页卡片自定义展示”能力：除固定图表卡片外，用户可在设置页选择首页展示卡片。
  - 设置页新增“首页卡片展示”配置项，支持选择 BMI、血压、餐次、健康记录、本周平均血糖、待处理控糖任务、健康档案完整度。
  - 首页仪表盘新增可选卡片，并基于真实数据动态展示新增指标。
  - 用户设置接口与数据模型新增 `dashboard_cards` 配置字段，并提供默认值兜底。
  - 数据库脚本新增 `Patch 19`，确保 `user_settings.dashboard_cards` 字段存在。
- SQL/配置变更：需要执行 `backend/patch_db.sql` 的 `Patch 19`
- 验证结果：代码与文档已更新；当前环境无法执行前端构建验证（WSL1 不支持）
- 回滚方案：回退 Dashboard/Settings/UserSettings 相关改动与 `Patch 19`

## TH-2026-02-019
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：功能/体验
- 影响范围：前端/仪表盘
- 详细说明：
  - 首页仪表盘改为真实数据驱动，不再使用固定演示数据。
  - BMI、血压、今日餐次、今日健康记录全部基于实际接口数据计算。
  - 一周趋势图改为按近7天健康记录动态绘制；今日餐次结构图改为按当日热量分布动态绘制。
  - 新增新用户空数据友好提醒与卡片状态文案，避免空白或误导性展示。
- SQL/配置变更：无
- 验证结果：代码已完成；当前环境无法执行前端构建验证（WSL1 不支持）
- 回滚方案：回退 `frontend/src/views/dashboard/Dashboard.vue`

## TH-2026-02-018
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：修复
- 影响范围：后端/控糖管理
- 详细说明：
  - 修复血糖记录接口在接收时间字符串时的反序列化错误。
  - 新增灵活时间解析工具，兼容 `yyyy-MM-dd HH:mm:ss`、`yyyy-MM-ddTHH:mm:ss` 等常见格式。
  - 血糖查询接口的 `start/end` 时间参数解析同步改为兼容模式。
- SQL/配置变更：无
- 验证结果：代码层修复完成；当前环境无法编译验证（缺少 `JAVA_HOME`）
- 回滚方案：回退 `GlucoseRecord`、`GlucoseRecordController` 与新增时间解析工具类

## TH-2026-02-017
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：文档/治理
- 影响范围：文档体系/交付追踪
- 详细说明：
  - 新增 `read/文档编号总览.md`，为现有项目文档按重要性统一分配编号。
  - 更新 `read/文档维护规范.md`，新增“文档编号管理（强制）”规则。
  - 明确后续新增文档必须先登记编号，再纳入项目流程。
- SQL/配置变更：无
- 验证结果：文档可按编号统一检索和引用
- 回滚方案：回退编号总览与维护规范对应修改及本条日志

## TH-2026-02-016
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：文档/需求追踪
- 影响范围：任务管理/AI配置测试追踪
- 详细说明：
  - 为 `E1 AI模型分工与配置` 分配正式变更编号 `TH-2026-02-016`。
  - 更新 `read/功能任务清单.md` 中 E1 的关联编号、状态与备注。
  - 新增 `read/AI配置与模型分工测试用例.md` 作为 E1 专项测试入口。
- SQL/配置变更：无
- 验证结果：E1 已可通过任务清单与专项测试文档追踪
- 回滚方案：回退任务清单、专项测试文档及本条日志

## TH-2026-02-015
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：文档/需求追踪
- 影响范围：任务管理/健康档案历史测试追踪
- 详细说明：
  - 为 `C4 健康档案历史版本` 分配正式变更编号 `TH-2026-02-015`。
  - 更新 `read/功能任务清单.md` 中 C4 的关联编号、状态与备注。
  - 新增 `read/健康档案历史测试用例.md` 作为 C4 专项测试入口。
- SQL/配置变更：无
- 验证结果：C4 已可通过任务清单与专项测试文档追踪
- 回滚方案：回退任务清单、专项测试文档及本条日志

## TH-2026-02-014
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：文档/需求追踪
- 影响范围：任务管理/食谱闭环测试追踪
- 详细说明：
  - 为 `B4 结合档案/知识库生成` 分配正式变更编号 `TH-2026-02-014`。
  - 更新 `read/功能任务清单.md` 中 B4 的关联编号、状态与备注。
  - 更新 `read/食谱反馈闭环测试用例.md` 追踪信息，纳入 B4。
- SQL/配置变更：无
- 验证结果：B4 已可通过任务清单与食谱闭环测试文档追踪
- 回滚方案：回退任务清单、测试文档及本条日志

## TH-2026-02-013
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：文档/需求追踪
- 影响范围：任务管理/食谱闭环测试追踪
- 详细说明：
  - 为 `B2 食谱导出PDF + 存档` 分配正式变更编号 `TH-2026-02-013`。
  - 更新 `read/功能任务清单.md` 中 B2 的关联编号、状态与备注。
  - 更新 `read/食谱反馈闭环测试用例.md` 追踪信息，纳入 B2。
- SQL/配置变更：无
- 验证结果：B2 已可通过任务清单与食谱闭环测试文档追踪
- 回滚方案：回退任务清单、测试文档及本条日志

## TH-2026-02-012
- 日期：2026-02-08
- 负责人：Codex
- 变更类型：文档/需求追踪
- 影响范围：任务管理/食谱闭环测试追踪
- 详细说明：
  - 为 `B1 多周期AI食谱生成` 分配正式变更编号 `TH-2026-02-012`。
  - 更新 `read/功能任务清单.md` 中 B1 的关联编号、状态与备注。
  - 更新 `read/食谱反馈闭环测试用例.md` 追踪信息，纳入 B1。
- SQL/配置变更：无
- 验证结果：B1 已可通过任务清单与食谱闭环测试文档追踪
- 回滚方案：回退任务清单、测试文档及本条日志

## TH-2026-02-011
- 日期：2026-02-07
- 负责人：Codex
- 变更类型：文档/需求追踪
- 影响范围：任务管理/饮食记录测试追踪
- 详细说明：
  - 为 `A5 按时间筛选 + 区间统计热量` 分配正式变更编号 `TH-2026-02-011`。
  - 更新 `read/功能任务清单.md` 中 A5 的关联编号、状态与备注。
  - 在 `read/饮食记录增强测试用例.md` 增加 A5 专项回归用例。
- SQL/配置变更：无
- 验证结果：A5 已可通过任务清单与专项测试文档追踪
- 回滚方案：回退任务清单与专项测试文档对应修改及本条日志

## TH-2026-02-010
- 日期：2026-02-07
- 负责人：Codex
- 变更类型：文档/需求追踪
- 影响范围：任务管理/饮食记录测试追踪
- 详细说明：
  - 为 `A4 允许手动填写热量` 分配正式变更编号 `TH-2026-02-010`。
  - 更新 `read/功能任务清单.md` 中 A4 的关联编号、状态与备注。
  - 在 `read/饮食记录增强测试用例.md` 增加 A4 专项回归用例。
- SQL/配置变更：无
- 验证结果：A4 已可通过任务清单与专项测试文档追踪
- 回滚方案：回退任务清单与专项测试文档对应修改及本条日志

## TH-2026-02-009
- 日期：2026-02-07
- 负责人：Codex
- 变更类型：文档/需求追踪
- 影响范围：任务管理/饮食记录测试追踪
- 详细说明：
  - 为 `A3 热量计算（本地+AI兜底）` 分配正式变更编号 `TH-2026-02-009`。
  - 更新 `read/功能任务清单.md` 中 A3 的关联编号、状态与备注。
  - 在 `read/饮食记录增强测试用例.md` 增加 A3 专项回归用例。
- SQL/配置变更：无
- 验证结果：A3 已可通过任务清单与专项测试文档追踪
- 回滚方案：回退任务清单与专项测试文档对应修改及本条日志

## TH-2026-02-008
- 日期：2026-02-07
- 负责人：Codex
- 变更类型：文档/需求追踪
- 影响范围：任务管理/饮食记录测试追踪
- 详细说明：
  - 为 `A2 饮食记录持久化与历史查看` 分配正式变更编号 `TH-2026-02-008`。
  - 更新 `read/功能任务清单.md` 中 A2 的关联编号、状态与备注。
  - 在 `read/饮食记录增强测试用例.md` 增加 A2 专项回归用例。
- SQL/配置变更：无
- 验证结果：A2 已可通过任务清单与专项测试文档追踪
- 回滚方案：回退任务清单与专项测试文档对应修改及本条日志

## TH-2026-02-007
- 日期：2026-02-07
- 负责人：Codex
- 变更类型：文档/需求追踪
- 影响范围：任务管理/饮食记录测试追踪
- 详细说明：
  - 为 `A1 自定义食物 + 自定义重量` 分配正式变更编号 `TH-2026-02-007`。
  - 更新 `read/功能任务清单.md` 中 A1 的关联编号、状态与备注。
  - 新增 `read/饮食记录增强测试用例.md` 作为 A1~A5 专项测试入口。
- SQL/配置变更：无
- 验证结果：A1 已可通过任务清单与专项测试文档追踪
- 回滚方案：回退任务清单、专项测试文档及本条日志

## TH-2026-02-006
- 日期：2026-02-07
- 负责人：Codex
- 变更类型：文档/需求追踪
- 影响范围：任务管理/前端测试追踪
- 详细说明：
  - 为 `C2 长期不变数据首次弹窗` 分配正式变更编号 `TH-2026-02-006`。
  - 更新 `read/功能任务清单.md` 中 C2 的关联编号与备注。
  - 在 `read/前端测试清单.md` 增加 C2 专项回归用例（首次弹窗、再次不弹、手动编辑入口）。
- SQL/配置变更：无
- 验证结果：C2 已可通过任务清单与前端测试清单追踪
- 回滚方案：回退任务清单与前端测试清单对应修改及本条日志

## TH-2026-02-005
- 日期：2026-02-07
- 负责人：Codex
- 变更类型：文档/需求追踪
- 影响范围：任务管理/前端测试追踪
- 详细说明：
  - 为 `C1 健康记录时间筛选` 分配正式变更编号 `TH-2026-02-005`。
  - 更新 `read/功能任务清单.md` 中 C1 的关联编号与备注。
  - 在 `read/前端测试清单.md` 增加 C1 专项回归用例（默认本周、预设筛选、自定义区间）。
- SQL/配置变更：无
- 验证结果：C1 已可通过任务清单与前端测试清单追踪
- 回滚方案：回退任务清单与前端测试清单对应修改及本条日志

## TH-2026-02-004
- 日期：2026-02-07
- 负责人：Codex
- 变更类型：文档/需求追踪
- 影响范围：任务管理/食谱导入测试追踪
- 详细说明：
  - 为 `B3 Excel/PDF导入食谱` 分配正式变更编号 `TH-2026-02-004`。
  - 更新 `read/功能任务清单.md` 中 B3 的关联编号与备注。
  - 在 `read/食谱导入规范.md` 增加追踪信息（任务编号、变更编号、关联文档）。
- SQL/配置变更：无
- 验证结果：B3 已可通过任务清单与导入规范文档追踪
- 回滚方案：回退任务清单与导入规范对应修改及本条日志

## TH-2026-02-003
- 日期：2026-02-07
- 负责人：Codex
- 变更类型：文档/需求追踪
- 影响范围：任务管理/控糖模块测试追踪
- 详细说明：
  - 将 `A6 糖尿病倾向记录扩展` 从“待登记”升级为正式变更编号 `TH-2026-02-003`。
  - 更新 `read/功能任务清单.md` 中 A6 的关联变更编号与备注。
  - 同步要求 `read/控糖管理测试用例.md` 作为该变更的主测试文档。
- SQL/配置变更：无
- 验证结果：A6 已可通过任务清单和测试文档反查到对应变更编号
- 回滚方案：回退任务清单编号映射与本条日志

## TH-2026-02-002
- 日期：2026-02-07
- 负责人：Codex
- 变更类型：文档/治理
- 影响范围：项目管理/测试追踪
- 详细说明：
  - 更新 `read/功能任务清单.md`，新增“任务追踪总览（统一口径）”。
  - 为任务增加 `当前状态`、`关联变更编号`、`对应测试文档` 字段。
  - 新增“大改后更新动作”，形成任务-变更-测试三向联动。
- SQL/配置变更：无
- 验证结果：任务清单已可按编号追踪到变更日志与测试文档
- 回滚方案：回退 `read/功能任务清单.md` 与本条日志

## TH-2026-02-001
- 日期：2026-02-07
- 负责人：Codex
- 变更类型：文档
- 影响范围：项目管理/发布流程
- 详细说明：
  - 新增 `read/文档维护规范.md`，明确“每次大改必同步文档”。
  - 建立本文件作为统一变更追踪入口。
  - 在上线手册与开发路线图中补充文档同步要求和执行规则。
- SQL/配置变更：无
- 验证结果：文档已创建并可访问
- 回滚方案：删除新增文档并回退相关引用

## TH-2026-01-007（补录）
- 日期：2026-01-24
- 负责人：项目组 / Codex（补录）
- 变更类型：功能/架构
- 影响范围：后端/前端/数据库/AI/PDF导出
- 对应提交：`404552a`
- 详细说明：
  - 新增后台 AI 配置管理能力（Key、BaseURL、Model 等）。
  - 引入食谱异步任务能力，支持长耗时生成流程。
  - 饮食记录新增宏量营养估算链路（碳水/糖），并持续优化食谱导出。
  - 前端新增管理端 AI 配置页面与路由、请求拦截和交互优化。
- SQL/配置变更：需要执行 `backend/patch_db.sql`（含 `ai_configs`、`meal_plan_tasks`、`food_nutrition_cache` 等相关补丁）
- 验证结果：功能联调通过，相关改动已在后续测试与文档中覆盖
- 回滚方案：回退到 `404552a` 之前版本并还原数据库变更（按备份恢复）

## TH-2026-01-006（补录）
- 日期：2026-01-24
- 负责人：项目组 / Codex（补录）
- 变更类型：文档/部署
- 影响范围：运维交付
- 对应提交：`3b7f70d`
- 详细说明：
  - 新增部署文档 `DEPLOY.md`，明确打包、部署、运行和环境要求。
- SQL/配置变更：无
- 验证结果：文档可用并用于后续上线手册沉淀
- 回滚方案：删除或回退该文档版本

## TH-2026-01-005（补录）
- 日期：2026-01-23
- 负责人：项目组 / Codex（补录）
- 变更类型：功能/稳定性
- 影响范围：后端/前端/数据库
- 对应提交：`36183aa`
- 详细说明：
  - 修复页面白屏相关问题（请求与路由异常处理链路增强）。
  - 新增健康档案历史记录能力（入库与查询）。
  - 健康档案接口与前端页面联动增强。
- SQL/配置变更：需要执行 `backend/patch_db.sql`（`health_profile_history` 相关补丁）
- 验证结果：健康档案历史记录可查询，白屏问题显著下降
- 回滚方案：回退代码并恢复历史表数据（如已写入）

## TH-2026-01-004（补录）
- 日期：2026-01-23
- 负责人：项目组 / Codex（补录）
- 变更类型：功能/体验
- 影响范围：后端/前端/数据库/导出
- 对应提交：`4b2f497`、`340e88d`
- 详细说明：
  - 饮食记录能力增强（热量估算、记录结构扩展、页面交互优化）。
  - 食谱中心导入导出能力增强（多格式适配与导出链路优化）。
  - 登录、聊天、设置等多个页面与路由体验修复。
- SQL/配置变更：需要执行 `backend/patch_db.sql`（`diet_logs` 扩展字段等）
- 验证结果：核心功能可用，后续测试清单持续回归
- 回滚方案：回退对应提交并恢复数据库至变更前备份

## TH-2026-01-003（补录）
- 日期：2026-01-23
- 负责人：项目组 / Codex（补录）
- 变更类型：修复/测试
- 影响范围：后端/数据库/自动化测试
- 对应提交：`95a9bcc`
- 详细说明：
  - 修复数据库结构不一致问题，补充 `backend/fix_schema.sql`。
  - 新增后端自动化测试脚本 `backend_test_runner.js` 并产出测试结果。
  - 后端接口清单回归后达到“全部通过”。
- SQL/配置变更：需要执行 `backend/fix_schema.sql` 与 `backend/patch_db.sql`
- 验证结果：见 `read/后端测试结果.md`
- 回滚方案：回退修复脚本执行结果并恢复数据库备份

## TH-2026-01-002（补录）
- 日期：2026-01-23
- 负责人：项目组 / Codex（补录）
- 变更类型：测试体系
- 影响范围：前端/后端/文档
- 对应提交：`613c17c`、`4bb7f9a`、`b3fa16e`、`e8e8059`
- 详细说明：
  - 建立后端测试清单与自动化测试脚本。
  - 建立前端复测页面与测试记录，形成“问题-验证-复测”文档链路。
  - 测试结果与错误细节持续归档，支撑后续修复闭环。
- SQL/配置变更：无
- 验证结果：测试资产已沉淀在 `read/` 目录
- 回滚方案：回退测试脚本与文档资产

## TH-2026-01-001（补录）
- 日期：2026-01-01
- 负责人：项目组 / Codex（补录）
- 变更类型：项目初始化
- 影响范围：前端/后端/数据库
- 对应提交：`839f202`（后续基准调整：`c7c0d58`）
- 详细说明：
  - 建立项目基础架构（Spring Boot + Vue + JWT + MySQL + AI 服务）。
  - 初始化核心模块：认证、健康记录、AI 对话、食谱、管理端。
  - 初始化数据库脚本、配置文件、前后端基础路由与页面结构。
- SQL/配置变更：初始化需要执行 `backend/src/main/resources/db/schema.sql`
- 验证结果：项目可启动并进入后续功能迭代
- 回滚方案：回退到仓库初始版本
