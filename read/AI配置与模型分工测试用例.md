# AI配置与模型分工测试用例

## 0. 追踪信息
- 关联任务编号：`E1`
- 关联变更编号：`TH-2026-02-016`
- 关联任务文档：`read/功能任务清单.md`
- 关联变更文档：`read/项目变更日志.md`

## 1. 目的与范围
验证“模型分工与配置管理”是否可用，覆盖：
- 管理端多模型配置（食谱模型/医疗建议模型）
- 配置启停与切换
- 不同业务路由到对应模型
- 配额与失败降级策略

## 2. 前置条件
1. 使用管理员账号登录并进入 AI 配置页面。
2. 至少准备两组可用模型配置（如 `MEAL_PLAN`、`MEDICAL_ADVICE`）。
3. 普通用户可访问 AI 对话与食谱生成页面。

## 3. 核心接口
- `GET /api/admin/ai-config`
- `POST /api/admin/ai-config`
- `PUT /api/admin/ai-config/{key}`（如已提供）
- `POST /api/chat/ask`
- `POST /api/meal-plan/generate-async`

## 4. 测试用例
| 编号 | 用例 | 步骤 | 预期结果 |
| --- | --- | --- | --- |
| AIC-001 | 新增配置 | 管理端新增 `MEAL_PLAN` 配置 | 保存成功，列表可见 |
| AIC-002 | 修改配置 | 修改模型名/温度参数 | 保存成功，后续请求生效 |
| AIC-003 | 禁用配置 | 禁用某个配置项 | 对应业务请求提示配置不可用，不白屏 |
| AIC-004 | 食谱模型路由 | 触发食谱生成 | 请求使用 `MEAL_PLAN` 模型配置 |
| AIC-005 | 医疗建议模型路由 | 发起健康建议问答 | 请求使用 `MEDICAL_ADVICE` 模型配置 |
| AIC-006 | 错误Key容错 | 故意填错 API Key | 返回可理解错误提示，不影响其他模块 |
| AIC-007 | 成本隔离验证 | 分别高频调用食谱与问答 | 两类调用可独立统计与限流（若已实现） |
| AIC-008 | 重启后配置持久化 | 重启后端后再次调用 | 配置仍有效，无需重新录入 |

## 5. 冒烟路径
1. 配置 `MEAL_PLAN` 并生成一次食谱成功。
2. 配置 `MEDICAL_ADVICE` 并完成一次问答成功。
3. 禁用其一并验证对应业务提示。
4. 恢复启用后再次验证成功。

## 6. 结果记录模板
- 用例编号：
- 执行时间：
- 实际结果：
- 是否通过：Pass/Fail
- 备注（截图/接口返回）：
