# 新增功能任务清单

> 说明: 下列任务按业务模块分组，含依赖与取舍建议，便于后续分阶段实现。

---

## A. 饮食记录增强
### A1. 自定义食物 + 自定义重量(g)
- 目标: 除推荐食物外允许自由输入食物名称，分量支持估算单位 + 直接输入克数。
- 依赖: 前端表单增强; 后端接口支持新增字段。
- 取舍: 若仅前端临时展示可不入库，但建议与记录一并保存。

### A2. 饮食记录持久化与历史查看
- 目标: 每次记录入库，用户可查看历史记录列表。
- 依赖: 后端 `diet_logs` 表结构与列表接口。
- 取舍: 若已有接口仅补 UI 列表与筛选。

### A3. 热量计算(本地表 + AI 兜底)
- 目标: 推荐食物从本地热量表计算; 非表内食物调用 AI 估算并打“仅供参考”标识。
- 依赖: 食物热量表(本地字典/表); AI 请求接口。
- 风险: AI 估算不稳定，需缓存结果并显式标识。

### A4. 允许手动填写热量
- 目标: 用户可填写明确热量(预包装食品等)，优先于自动估算。
- 依赖: UI 字段 + 后端入库。

### A5. 按时间筛选 + 区间统计热量
- 目标: 支持按日/周/月/自定义区间筛选与统计总摄入热量。
- 依赖: 后端查询参数 + 前端筛选组件。

### A6. 糖尿病倾向记录扩展
- 目标: 增加糖尿病友好数据(如碳水克数、GI/GL、含糖量等)。
- 依赖: 食物营养数据表; 计算逻辑。
- 取舍: 先做“碳水/糖克数”最小集。

---

## B. 食谱中心增强
### B1. AI 生成多周期食谱(单餐/一天/三天/一周)
- 目标: 根据用户需求生成不同周期食谱，可保存至食谱中心。
- 依赖: 后端 AI Prompt 扩展; UI 输入需求。

### B2. 食谱导出 PDF + 存档
- 目标: AI 生成结果可保存、可导出 PDF。
- 依赖: 后端 PDF 导出; 食谱存储表。

### B3. Excel/PDF 导入食谱
- 目标: 支持导入，建立“食谱格式规范”。
- 依赖: 文件上传、解析器、格式校验。
- 取舍: 先做 Excel(结构化)再支持 PDF(复杂度高)。

### B4. 需求输入 + 结合健康档案/知识库生成
- 目标: 用户输入需求(口味/忌口/目标)，结合健康档案+指南生成。
- 依赖: 健康档案完整度、知识库检索能力。

---

## C. 健康档案与数据记录增强
### C1. 记录筛选(默认本周)
- 目标: 健康记录按时间筛选(1天/3天/1周/1月/全部/自定义区间)。
- 依赖: 后端查询参数; 前端筛选组件。

### C2. 长期不变数据(身高/忌口)首次弹窗
- 目标: 首次进入数据记录页弹窗填写，之后在入口中可编辑。
- 依赖: 本地标记/服务端标记 + UI。
- 取舍: 可先用本地存储标记，后续再上服务端。

### C3. 健康档案字段扩展 + 风险阈值提示
- 目标: OCR 体检报告字段更完整; 对超范围值提示风险。
- 依赖: 字段清单与范围标准; 风险规则引擎。
- 风险: 指南版本更新需维护。

### C4. 健康档案历史版本
- 目标: 档案保存留档，可查看与编辑历史记录。
- 依赖: 新表结构或版本表; UI 切换与对比。
- 取舍: 先做只读历史，再支持编辑。

---

## D. 冗余/冲突评估
- 饮食记录 vs 食谱中心: 明确“记录实际摄入”与“计划食谱”的边界。
- 健康档案 vs 数据记录: 档案是低频基础信息，记录是高频测量数据。
- AI 估算热量 vs 手动输入: 优先手动值，AI 仅兜底且标识。

---

## E. AI 模型分工与配置
### E1. 食谱生成与医疗建议分模型
- 目标: 食谱生成与医疗建议分别使用不同模型(或不同 API key)以区分成本与准确度。
- 依赖: AI 请求路由与配置管理(可复用系统配置管理方案)。
- 取舍: 同 key 也可多模型调用；如需配额隔离再拆分 key。

---

## 建议实施顺序(可调整)
1) A1/A2/A5 (饮食记录闭环 + 筛选统计)
2) A3/A4 (热量计算与手动兜底)
3) C1/C2 (记录筛选与长期数据)
4) B1/B2 (多周期食谱 + 保存/导出)
5) B3/B4 (导入与需求输入)
6) C3/C4 (档案扩展与历史版本)
7) A6 (糖尿病深度数据)
8) E1 (AI 模型分工与配置)
