# 新增功能任务清单

> 说明: 下列任务按业务模块分组，含依赖与取舍建议，便于后续分阶段实现。
> 追踪规则: 每次大改后必须同步更新本文件、`read/项目变更日志.md`、对应测试文档。

---

## 任务追踪总览（统一口径）

状态说明：
- `已完成`：功能已实现并有回归记录。
- `进行中`：已开始开发或联调，尚未验收关闭。
- `规划中`：仅在路线图/任务清单登记，未进入开发。
- `待补录`：功能已改动但尚未补齐“变更编号/测试记录”。

| 任务编号 | 任务名称 | 当前状态 | 关联变更编号 | 对应测试文档 | 备注 |
| --- | --- | --- | --- | --- | --- |
| A1 | 自定义食物 + 自定义重量 | 进行中 | TH-2026-02-007 | read/饮食记录增强测试用例.md | 已登记专项迭代，按前后端联调用例回归 |
| A2 | 饮食记录持久化与历史查看 | 进行中 | TH-2026-02-008 | read/饮食记录增强测试用例.md | 已登记专项迭代，验证记录聚合与历史可见性 |
| A3 | 热量计算（本地+AI兜底） | 进行中 | TH-2026-02-009 | read/饮食记录增强测试用例.md | 已登记专项迭代，验证缓存命中与AI降级 |
| A4 | 允许手动填写热量 | 进行中 | TH-2026-02-010 | read/饮食记录增强测试用例.md | 已登记专项迭代，验证手填优先级 |
| A5 | 按时间筛选 + 区间统计热量 | 进行中 | TH-2026-02-011 | read/饮食记录增强测试用例.md | 已登记专项迭代，验证时间边界与统计口径 |
| A6 | 糖尿病倾向记录扩展 | 进行中 | TH-2026-02-003 | read/控糖管理测试用例.md | 已登记为专项迭代，按控糖用例持续回归 |
| B1 | 多周期AI食谱生成 | 进行中 | TH-2026-02-012, TH-2026-02-024, TH-2026-02-027, TH-2026-02-030 | read/食谱反馈闭环测试用例.md | 已增加每餐营养计算、历史需求复用与自动保存 |
| B2 | 食谱导出PDF + 存档 | 进行中 | TH-2026-02-013 | read/食谱反馈闭环测试用例.md | 已登记专项迭代，按导出可读性与存档回归 |
| B3 | Excel/PDF导入食谱 | 进行中 | TH-2026-02-004 | read/食谱导入规范.md | 已登记专项迭代，按导入规范与导入回归验收 |
| B4 | 结合档案/知识库生成 | 进行中 | TH-2026-02-014 | read/食谱反馈闭环测试用例.md | 已登记专项迭代，补充RAG来源可见性回归 |
| C1 | 健康记录时间筛选 | 进行中 | TH-2026-02-005 | read/前端测试清单.md | 已登记专项迭代，按时间筛选边界专项回归 |
| C2 | 长期不变数据首次弹窗 | 进行中 | TH-2026-02-006 | read/前端测试清单.md | 已登记专项迭代，按“首次弹出/再次不弹出”回归 |
| C3 | 档案字段扩展 + 风险提示 | 进行中 | TH-2026-01-005 | read/控糖管理测试用例.md | 需补风险阈值口径说明 |
| C4 | 健康档案历史版本 | 进行中 | TH-2026-02-015 | read/健康档案历史测试用例.md | 已登记专项迭代，补历史查看与回溯编辑回归 |
| E1 | AI模型分工与配置 | 进行中 | TH-2026-02-016 | read/AI配置与模型分工测试用例.md | 已登记专项迭代，补模型隔离与成本限额回归 |
| F1 | 首页卡片自定义展示 | 进行中 | TH-2026-02-020 | read/前端测试清单.md | 已登记专项迭代，支持用户自定义首页卡片 |
| F2 | 首页热量环图双口径切换 | 进行中 | TH-2026-02-023 | read/前端测试清单.md | 已登记专项迭代，支持按餐次/按食物类型切换 |

---

## 更新动作（每次大改后执行）
1. 在“任务追踪总览”更新 `当前状态`、`关联变更编号`、`备注`。
2. 在 `read/项目变更日志.md` 新增对应变更条目。
3. 在相应测试文档补充测试用例和结果。

---

## A. 饮食记录增强
### A1. 自定义食物 + 自定义重量(g)
- 目标: 除推荐食物外允许自由输入食物名称，分量支持估算单位 + 直接输入克数。
- 依赖: 前端表单增强; 后端接口支持新增字段。
- 取舍: 若仅前端临时展示可不入库，但建议与记录一并保存。

### A2. 饮食记录持久化与历史查看
- 目标: 每次记录入库，用户可查看历史记录列表。
- 依赖: 后端 `diet_logs` 表结构与列表接口。
- 取舍: 若已有接口仅补 UI 列表与筛选。

### A3. 热量计算(本地表 + AI 兜底)
- 目标: 推荐食物从本地热量表计算; 非表内食物调用 AI 估算并打“仅供参考”标识。
- 依赖: 食物热量表(本地字典/表); AI 请求接口。
- 风险: AI 估算不稳定，需缓存结果并显式标识。

### A4. 允许手动填写热量
- 目标: 用户可填写明确热量(预包装食品等)，优先于自动估算。
- 依赖: UI 字段 + 后端入库。

### A5. 按时间筛选 + 区间统计热量
- 目标: 支持按日/周/月/自定义区间筛选与统计总摄入热量。
- 依赖: 后端查询参数 + 前端筛选组件。

### A6. 糖尿病倾向记录扩展
- 目标: 增加糖尿病友好数据(如碳水克数、GI/GL、含糖量等)。
- 依赖: 食物营养数据表; 计算逻辑。
- 取舍: 先做“碳水/糖克数”最小集。

---

## B. 食谱中心增强
### B1. AI 生成多周期食谱(单餐/一天/三天/一周)
- 目标: 根据用户需求生成不同周期食谱，可保存至食谱中心。
- 依赖: 后端 AI Prompt 扩展; UI 输入需求。

### B2. 食谱导出 PDF + 存档
- 目标: AI 生成结果可保存、可导出 PDF。
- 依赖: 后端 PDF 导出; 食谱存储表。

### B3. Excel/PDF 导入食谱
- 目标: 支持导入，建立“食谱格式规范”。
- 依赖: 文件上传、解析器、格式校验。
- 取舍: 先做 Excel(结构化)再支持 PDF(复杂度高)。

### B4. 需求输入 + 结合健康档案/知识库生成
- 目标: 用户输入需求(口味/忌口/目标)，结合健康档案+指南生成。
- 依赖: 健康档案完整度、知识库检索能力。

---

## C. 健康档案与数据记录增强
### C1. 记录筛选(默认本周)
- 目标: 健康记录按时间筛选(1天/3天/1周/1月/全部/自定义区间)。
- 依赖: 后端查询参数; 前端筛选组件。

### C2. 长期不变数据(身高/忌口)首次弹窗
- 目标: 首次进入数据记录页弹窗填写，之后在入口中可编辑。
- 依赖: 本地标记/服务端标记 + UI。
- 取舍: 可先用本地存储标记，后续再上服务端。

### C3. 健康档案字段扩展 + 风险阈值提示
- 目标: OCR 体检报告字段更完整; 对超范围值提示风险。
- 依赖: 字段清单与范围标准; 风险规则引擎。
- 风险: 指南版本更新需维护。

### C4. 健康档案历史版本
- 目标: 档案保存留档，可查看与编辑历史记录。
- 依赖: 新表结构或版本表; UI 切换与对比。
- 取舍: 先做只读历史，再支持编辑。

---

## D. 冗余/冲突评估
- 饮食记录 vs 食谱中心: 明确“记录实际摄入”与“计划食谱”的边界。
- 健康档案 vs 数据记录: 档案是低频基础信息，记录是高频测量数据。
- AI 估算热量 vs 手动输入: 优先手动值，AI 仅兜底且标识。

---

## E. AI 模型分工与配置
### E1. 食谱生成与医疗建议分模型
- 目标: 食谱生成与医疗建议分别使用不同模型(或不同 API key)以区分成本与准确度。
- 依赖: AI 请求路由与配置管理(可复用系统配置管理方案)。
- 取舍: 同 key 也可多模型调用；如需配额隔离再拆分 key。

---

## F. 仪表盘个性化增强
### F1. 首页卡片自定义展示
- 目标: 用户可在设置页选择首页卡片（固定趋势图与餐次结构图不可移除）。
- 依赖: 用户设置表新增卡片配置字段；首页仪表盘读取该配置并实时生效。
- 取舍: 默认展示核心卡片，避免新用户首页信息过少。

### F2. 首页热量结构双口径切换
- 目标: 今日热量环图支持按餐次与按食物类型两种口径，点击环图快速切换。
- 依赖: 仪表盘环图渲染逻辑扩展与食物类型分类规则。
- 取舍: 先采用规则分类（关键词+碳水兜底），后续可接营养成分库做更精细分类。

---

## 建议实施顺序(可调整)
1) A1/A2/A5 (饮食记录闭环 + 筛选统计)
2) A3/A4 (热量计算与手动兜底)
3) C1/C2 (记录筛选与长期数据)
4) B1/B2 (多周期食谱 + 保存/导出)
5) B3/B4 (导入与需求输入)
6) C3/C4 (档案扩展与历史版本)
7) A6 (糖尿病深度数据)
8) E1 (AI 模型分工与配置)
