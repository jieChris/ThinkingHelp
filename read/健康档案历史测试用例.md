# 健康档案历史测试用例

## 0. 追踪信息
- 关联任务编号：`C4`
- 关联变更编号：`TH-2026-02-015`
- 关联任务文档：`read/功能任务清单.md`
- 关联变更文档：`read/项目变更日志.md`

## 1. 目的与范围
验证健康档案历史能力是否可用，覆盖：
- 每次保存是否生成历史版本
- 历史列表按时间展示
- 历史详情可查看
- 回溯恢复或对比流程（若已实现）
- 异常数据与权限场景

## 2. 前置条件
1. 后端已执行 `backend/patch_db.sql`，包含 `health_profile_history` 表。
2. 使用普通用户登录并进入健康档案页面。
3. 已至少保存 2 次不同档案内容。

## 3. 核心接口
- `POST /api/health/profile`
- `GET /api/health/profile`
- `GET /api/health/profile/history`
- `GET /api/health/profile/history/{id}`（如已提供）

## 4. 测试用例
| 编号 | 用例 | 步骤 | 预期结果 |
| --- | --- | --- | --- |
| HPH-001 | 保存生成历史 | 连续保存两次不同档案 | 历史列表新增两条记录 |
| HPH-002 | 列表按时间排序 | 打开历史列表 | 默认按时间倒序显示最新记录 |
| HPH-003 | 历史详情可读 | 点击任一历史记录查看 | 显示当时保存的完整字段快照 |
| HPH-004 | 当前档案不受历史查看影响 | 查看历史后返回当前档案 | 当前数据保持不变 |
| HPH-005 | 权限隔离 | 使用其他账号访问历史接口 | 仅能看到本账号历史，不能越权 |
| HPH-006 | 空历史场景 | 新用户首次进入历史页 | 页面显示“暂无历史记录”，不报错 |
| HPH-007 | 字段兼容性 | 历史中含新增字段（如活动水平） | 页面可正常展示，无崩溃或空白 |

## 5. 冒烟路径
1. 保存当前档案（版本1）。
2. 修改体重或疾病后再次保存（版本2）。
3. 打开历史列表验证出现 2 条记录。
4. 打开版本1详情核对字段。

## 6. 结果记录模板
- 用例编号：
- 执行时间：
- 实际结果：
- 是否通过：Pass/Fail
- 备注（截图/接口返回）：
